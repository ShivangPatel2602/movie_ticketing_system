<%= form_with(model: ticket) do |form| %>
  <% if ticket.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(ticket.errors.count, "error") %> prohibited this ticket from being saved:</h2>
      <ul>
        <% ticket.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <strong><%= form.label :user_id, "User Email: " %></strong>
    <%= current_user.email %>
  </div>

  <div>
    <strong><%= form.label :show_id, "Movie & Show: " %></strong>
    <%= @show.movie.title %> - <%= @show.date %> <%= @show.time.strftime("%I:%M %p") %>
  </div>

  <div>
    <%= form.label :number_of_tickets, "Number of Tickets", for: "num_tickets" %>
    <%= form.number_field :number_of_tickets, min: 1, id: "num_tickets" %>
  </div>


  <div>
    <%= form.label @show.price, "Price per ticket" %>
    <%= @show.price %>
  </div>

  <p><strong>Total Price:</strong> $<span id="total_price"></span></p>

  <div>
    <p><strong>Credit Card Information:</strong></p>
    <p>Card Holder: <%= current_user.name %></p>
    <p>Card Number: **** **** **** <%= current_user.card_number.last(4) %></p>
    <p>Expiry Date: <%= current_user.expirate_date %></p>
  </div>

  <div>
    <%= form.label :status %>
    <%= form.select :status, ['Booked', 'Cancelled'] %>
  </div>

  <%= form.hidden_field :show_id, value: @show.id %>
  <%= form.hidden_field :user_id, value: current_user.id %>

  <div>
    <%= form.submit "Book Ticket" %>
  </div>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const ticketInput = document.getElementById("num_tickets");
    const pricePerTicket = <%= @show.price %>;  // Ensure this is passed correctly
    const totalPriceElement = document.getElementById("total_price");

    function updateTotalPrice() {
      const numTickets = parseInt(ticketInput.value) || 0;
      totalPriceElement.innerText = (numTickets * pricePerTicket).toFixed(2);
    }

    // Event listener for updating total price dynamically
    ticketInput.addEventListener("input", updateTotalPrice);

    // Initialize the total price on page load
    updateTotalPrice();
  });
</script>